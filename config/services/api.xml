<container
    xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"
>
    <services>
        <!-- For production environments, consider using Redis or APCu instead of filesystem -->
        <service id="synerise_integration.api.cache_adapter" class="Synerise\Sdk\Api\Cache\PsrItemPoolTokenCache">
            <argument type="service" id="cache.app" on-invalid="null" />
        </service>
        <service id="synerise_integration.api.middleware.log.factory" class="Synerise\Sdk\Guzzle\Middleware\LogMiddlewareFactory">
            <argument type="service" id="logger" on-invalid="null" />

            <tag name="monolog.logger" channel="synerise"/>
        </service>
        <service id="synerise_integration.api.anonymous.middleware.retry.factory" class="Synerise\Sdk\Guzzle\Middleware\RetryMiddlewareFactory">
            <argument type="service" id="synerise_integration.api.anonymous.authentication_provider.factory" />
            <argument type="service" id="logger" on-invalid="null" />

            <tag name="monolog.logger" channel="synerise"/>
        </service>
        <service id="synerise_integration.api.default.middleware.retry.factory" class="Synerise\Sdk\Guzzle\Middleware\RetryMiddlewareFactory">
            <argument type="service" id="synerise_integration.api.default.authentication_provider.factory" />
            <argument type="service" id="logger" on-invalid="null" />

            <tag name="monolog.logger" channel="synerise"/>
        </service>
        <service id="synerise_integration.api.middleware.authentication.factory" class="Synerise\Sdk\Guzzle\AuthenticationMiddlewareFactory">
            <argument type="service" id="synerise_integration.api.anonymous.middleware.retry.factory" />
        </service>
        <service id="synerise_integration.api.middleware.default.factory" class="Synerise\Sdk\Guzzle\DefaultMiddlewareFactory">
            <argument type="service" id="synerise_integration.api.default.middleware.retry.factory" />
            <argument type="service" id="synerise_integration.api.middleware.log.factory" />
        </service>
        <service id="synerise_integration.api.request_adapter.factory" class="Synerise\Sdk\Guzzle\RequestAdapterFactory">
            <argument type="service" id="synerise_integration.guzzle.client.factory" />
        </service>
        <service id="synerise_integration.api.anonymous.authentication_provider.factory" class="Synerise\Sdk\Api\Authentication\AnonymousAuthenticationProviderFactory"/>
        <service id="synerise_integration.api.default.authentication_provider.factory" class="Synerise\Sdk\Api\Authentication\DefaultAuthenticationProviderFactory">
            <argument type="service" id="synerise_integration.api.request_adapter.factory" />
            <argument type="service" id="synerise_integration.api.middleware.authentication.factory" />
            <argument type="service" id="synerise_integration.api.cache_adapter" />
        </service>
        <service id="synerise_integration.api.client_builder.factory" class="Synerise\Sdk\Api\ClientBuilderFactory">
            <argument type="service" id="synerise_integration.api.default.authentication_provider.factory" />
            <argument type="service" id="synerise_integration.api.request_adapter.factory" />
            <argument type="service" id="synerise_integration.api.middleware.default.factory" />
        </service>
        <service id="synerise_integration.api.client_builder" class="Synerise\Sdk\Api\ClientBuilder">
            <factory service="synerise_integration.api.client_builder.factory" method="create"/>
            <argument type="service" id="synerise_integration.context.workspace" />
        </service>
        <service id="synerise_integration.guzzle.client.factory" class="Synerise\Sdk\Guzzle\ClientFactory" />
        <!-- EVENT REQUEST HANDLER FACTORY -->
        <service id="synerise_integration.api.request_handler.event.request_handler.factory" class="Synerise\SyliusIntegrationPlugin\Api\EventRequestHandlerFactory">
            <argument type="service" id="synerise_integration.api.client_builder.factory" />
            <argument type="service" id="synerise_integration.channel_configuration.factory" />
            <argument type="service" id="synerise_integration.synchronization_configuration.factory" />
            <argument type="collection">
                <argument key="product.addToCart">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\AddedToCartRequestHandler</argument>
                <argument key="product.removeFromCart">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\RemovedFromCartRequestHandler</argument>
                <argument key="product.addReview">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\ProductAddReviewRequestHandler</argument>
                <argument key="cart.status">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\CustomEventRequestHandler</argument>
                <argument key="client.login">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\LoginRequestHandler</argument>
                <argument key="client.logout">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\LogoutRequestHandler</argument>
                <argument key="client.register">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Event\RegisterRequestHandler</argument>
                <argument key="profile.update">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Resource\ProfileRequestHandler</argument>
                <argument key="transaction.charge">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Resource\TransactionRequestHandler</argument>
                <argument key="product.update">Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Resource\AddItemRequestHandler</argument>
            </argument>
        </service>
        <!-- RESOURCE REQUEST HANDLERS -->
        <service id="synerise_integration.api.request_handler.batch.customer" class="Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Resource\ProfileRequestHandler">
            <argument type="service" id="synerise_integration.api.client_builder.factory" />
            <argument type="service" id="synerise_integration.channel_configuration.factory" />
            <argument type="service" id="synerise_integration.synchronization_configuration.factory" />
        </service>
        <service id="synerise_integration.api.request_handler.batch.order" class="Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Resource\TransactionRequestHandler">
            <argument type="service" id="synerise_integration.api.client_builder.factory" />
            <argument type="service" id="synerise_integration.channel_configuration.factory" />
            <argument type="service" id="synerise_integration.synchronization_configuration.factory" />
        </service>
        <service id="synerise_integration.api.request_handler.batch.product" class="Synerise\SyliusIntegrationPlugin\Api\RequestHandler\Resource\AddItemRequestHandler">
            <argument type="service" id="synerise_integration.api.client_builder.factory" />
            <argument type="service" id="synerise_integration.channel_configuration.factory" />
            <argument type="service" id="synerise_integration.synchronization_configuration.factory" />
        </service>
        <!-- EVENT REQUEST MAPPERS -->
        <service id="synerise_integration.api.request_mapper.event.cart_item_add" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\OrderItemAddToCartEventMapper">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.cart_item_remove" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\OrderItemRemoveToCartEventMapper">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.cart_status" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\OrderToCartStatusEventMapper">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.product_add_review" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\ReviewToProductAddReviewEvent">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.customer_logged_in" class="\Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\CustomerToLoggedInEvent">
            <argument type="service" id="event_dispatcher" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.customer_logged_out" class="\Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\CustomerToLoggedOutEvent">
            <argument type="service" id="event_dispatcher" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.customer_registered" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Event\CustomerToRegisteredEvent">
            <argument type="service" id="event_dispatcher" />
        </service>
        <service id="synerise_integration.api.request_mapper.event.order" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Resource\OrderToTransactionMapper">
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
            <argument type="service" id="synerise_integration.sdk.source_provider" />
        </service>
        <!-- RESOURCE REQUEST MAPPERS -->
        <service id="synerise_integration.api.request_mapper.resource.customer" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Resource\CustomerToProfileMapper" />
        <service id="synerise_integration.api.request_mapper.resource.order" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Resource\OrderToTransactionMapper" >
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
            <argument type="service" id="synerise_integration.sdk.source_provider" />
        </service>
        <service id="synerise_integration.api.request_mapper.resource.product" class="Synerise\SyliusIntegrationPlugin\Api\RequestMapper\Resource\ProductToAddItemMapper">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="synerise_integration.synchronization_configuration.factory" />
            <argument type="service" id="synerise_integration.helper.product_data_formatter" />
        </service>
    </services>
</container>
