<?xml version="1.0" encoding="UTF-8" ?>

<container
    xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"
>
    <imports>
        <import resource="services/**" />
    </imports>

    <services>
        <service id="synerise_integration.channel_configuration_factory" class="Synerise\SyliusIntegrationPlugin\Entity\ChannelConfigurationFactory">
            <argument type="service" id="sylius.context.channel" />
            <argument type="service" id="synerise_integration.repository.channel_configuration" />
        </service>
        <service id="synerise_integration.synchronization_configuration_factory" class="Synerise\SyliusIntegrationPlugin\Entity\SynchronizationConfigurationFactory">
            <argument type="service" id="sylius.context.channel" />
            <argument type="service" id="synerise_integration.repository.synchronization_configuration" />
        </service>
        <service id="synerise_integration.context.channel_configuration" class="Synerise\SyliusIntegrationPlugin\Entity\ChannelConfigurationInterface">
            <factory service="synerise_integration.channel_configuration_factory" method="get" />
        </service>
        <service id="synerise_integration.context.workspace" class="Synerise\SyliusIntegrationPlugin\Entity\WorkspaceInterface">
            <factory service="synerise_integration.channel_configuration_factory" method="getWorkspace" />
        </service>
        <service id="synerise_integration.cookie_profile_manager" class="Synerise\Sdk\Cookie\CookieProfileManager">
            <argument type="service" id="synerise_integration.helper.cookie_container" />
        </service>
        <service id="synerise_integration.identity_manager" class="Synerise\Sdk\Tracking\IdentityManager">
            <argument type="service" id="synerise_integration.cookie_profile_manager" />
            <argument type="service" id="synerise_integration.helper.uuid_generator" />
            <argument type="service" id="synerise_integration.sdk.profile_merge_action" />
        </service>
        <service id="synerise_integration.helper.uuid_generator" class="Synerise\SyliusIntegrationPlugin\Helper\UuidGenerator"/>
        <service id="synerise_integration.helper.cookie_container" class="Synerise\SyliusIntegrationPlugin\Helper\CookieContainer">
            <argument type="service" id="synerise_integration.context.channel_configuration" />
        </service>
        <service id="synerise_integration.helper.product_url_helper" class="Synerise\SyliusIntegrationPlugin\Helper\ProductUrlHelper">
            <argument type="service" id="sylius.context.channel" />
            <argument type="service" id="router" />
        </service>
        <!-- SOURCE PROVIDER -->
        <service id="synerise_integration.mobile_detect" class="Detection\MobileDetect"/>
        <service id="synerise_integration.sdk.source_provider" class="Synerise\Sdk\Tracking\DefaultEventSourceProvider">
            <argument type="service" id="synerise_integration.mobile_detect" />
        </service>
        <service id="synerise_integration.sdk.profile_merge_action" class="Synerise\Sdk\Tracking\ProfileMergeDoRequest">
            <argument type="service" id="synerise_integration.api_client_builder" />
        </service>
        <!-- KIOTA SERIALIZATION -->
        <service id="synerise_integration.kiota.serialization.json.serialization_writer_factory" class="Microsoft\Kiota\Serialization\Json\JsonSerializationWriterFactory" />
        <service id="synerise_integration.serialization.string_json_parse_node_factory" class="Synerise\Sdk\Serialization\StringJsonParseNodeFactory" />
    </services>
</container>
